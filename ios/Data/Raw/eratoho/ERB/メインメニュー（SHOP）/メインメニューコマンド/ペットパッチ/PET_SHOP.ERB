@SHOP_PET
#DIM  TEMP_REDRAW
	
	CURRENTREDRAW
	TEMP_REDRAW = RESULT
	REDRAW 0

	DRAWLINE
	PRINTFORML 要対寵物做什麼？
	DRAWLINE
	PRINTFORML %"PT的状態", 15, LEFT%:
	PRINTFORML %CALLNAME:1, 15, LEFT%:%PET_SUBMISSION_STR(1)%
	SIF FLAG:10
		PRINTFORML %CALLNAME:(FLAG:10), 15, LEFT%:%PET_SUBMISSION_STR(FLAG:10)%
	SIF FLAG:11
		PRINTFORML %CALLNAME:(FLAG:11), 15, LEFT%:%PET_SUBMISSION_STR(FLAG:11)%
	DRAWLINE
	PRINTFORML [1] - 給食物
	PRINTFORML [2] - 献上身体
	PRINTFORML [3] - 消費営養做各種各樣的事
	PRINTFORML [4] - 変更寵物的名字
	IF TALENT:1:140 == 1 || TALENT:(FLAG:10):140 == 1 || TALENT:(FLAG:11):140 == 1
		PRINTFORML [5] - 下克上
	ENDIF
	PRINTFORML [999] - 和寵物再見
	PRINTFORML [0] - 返回
	
	REDRAW TEMP_REDRAW
	
	$INPUT_LOOP
	INPUT
	IF RESULT == 1
		CALL FOOD_TO_PET
	ELSEIF RESULT == 2
		CALL BODY_TO_PET
	ELSEIF RESULT == 3
		CALL PET_USE_EXP
	ELSEIF RESULT == 4
		CALL RENAME_PET
	ELSEIF RESULT == 5
		CALL CONTRACT_PET
	ELSEIF RESULT == 999
		JUMP BYEBYE_PET
	ELSEIF RESULT == 0
		RETURN
	ELSE
		GOTO INPUT_LOOP
	ENDIF
	RESTART

@PET_USE_EXP
#DIM  TEMP_REDRAW
	LOCAL = 100 + (PET_SUBMISSION_PT() / GET_MEMBER_SUM())
	LOCAL:1 = 100 + PET:1 * 50 + (PET_SUBMISSION_PT() / GET_MEMBER_SUM())
	
	CURRENTREDRAW
	TEMP_REDRAW = RESULT
	REDRAW 0
	
	DRAWLINE
	PRINTFORML 可以消費営養做各種各樣的事
	PRINTFORML 要做什麼？
	IF PET_EXP_ENOUGH(LOCAL)
		PRINTFORML [1] - 提升等級    消費{LOCAL}経験値
	ELSE
		SETCOLOR 0x333333
		PRINTFORML [1] - 提升等級所需的営養不足
		RESETCOLOR
	ENDIF
	IF PET_EXP_ENOUGH(LOCAL:1) && PET:1 <= 6
		PRINTFORML [2] - 提升階級    消費{LOCAL}経験値
	ELSEIF PET:1 >= 7
		SETCOLOR 0x333333
		PRINTFORML [2] - %PETNAME%已経們到了最高階級
		RESETCOLOR
	ELSE
		SETCOLOR 0x333333
		PRINTFORML [2] - 提升階級所需的営養不足
		RESETCOLOR
	ENDIF
	PRINTFORML [3] - 生産道具
	PRINTFORML [0] - 返回
	
	REDRAW TEMP_REDRAW
	
	$INPUT_LOOP
	INPUT
	IF RESULT == 1 && PET_EXP_ENOUGH(LOCAL) && PET:1 != 9999
		CALL PET_LVUP(LOCAL)
	ELSEIF RESULT == 1 && !PET_EXP_ENOUGH(LOCAL)
		REUSELASTLINE 好像沒有満足提升等級所需的営養……
		GOTO INPUT_LOOP
	ELSEIF RESULT == 1 && PET_EXP_ENOUGH(LOCAL) && PET:1 >= 9999
		REUSELASTLINE 想要提高等級、但是%PETNAME%的等級已経提升到了極限……
		GOTO INPUT_LOOP

	ELSEIF RESULT == 2 && PET_EXP_ENOUGH(LOCAL:1) && PET:1 <= 6
		CALL PET_RANKUP(LOCAL:1)
	ELSEIF RESULT == 2 && !PET_EXP_ENOUGH(LOCAL:1) && PET:1 <= 6
		REUSELASTLINE 好像沒有満足提升階級所需的営養……
	ELSEIF RESULT == 2 && PET_EXP_ENOUGH(LOCAL:1) && PET:1 >= 7
		REUSELASTLINE 想要提高階級、但是%PETNAME%的階級已経提升到了極限……

	ELSEIF RESULT == 3
		JUMP PET_EXP_SHOP

	ELSEIF RESULT == 0
		RETURN

	ELSE
		REUSELASTLINE 不正入力です。正しい値を入力してください。
		GOTO INPUT_LOOP
	ENDIF


;-----------------------------------
;レベルアップ用関数
;-----------------------------------
@PET_LVUP(ARG:0)
#DIM  TEMP_REDRAW

PET:2 ++
PET:21 -= ARG:0

CURRENTREDRAW
TEMP_REDRAW = RESULT
REDRAW 0

PRINTL
SETCOLOR 255, 255, 0
IF FLAG:AUTOMODE
	PRINTFORML 等　級 提　升　！　！
	TWAIT FLAG:AUTOMODE * 400, 0
ELSE
	PRINTFORMW 等　級 提　升　！　！
ENDIF
RESETCOLOR
PRINTFORML
IF FLAG:AUTOMODE
	PRINTFORML 恭喜！　請選択奨勵
	TWAIT FLAG:AUTOMODE * 400, 0
ELSE
	PRINTFORMW 恭喜！　請選択奨勵
ENDIF
PRINTFORML 等級:{PET:2 - 1, 4} →{PET:2, 4}
PRINTFORML [0] - 戦闘能力   現在:{PET:10, 4}
PRINTFORML [1] - 速度       現在:{PET:11, 4}
PRINTFORML [2] - 干勁   　  現在:{PET:12, 4}
PRINTFORML [3] - 魅力度     現在:{PET:13, 4}

REDRAW TEMP_REDRAW

$INPUT_LOOP
INPUT
IF RESULT >= 0 && RESULT <= 3
	IF PET:(RESULT + 10) == 9999
		REUSELASTLINE 已経封頂了
		GOTO INPUT_LOOP
	ELSE
		PRINTL
		SELECTCASE RESULT
			CASE 0
				PRINT 戦闘能力
			CASE 1
				PRINT 速度
			CASE 2
				PRINT 幹勁
			CASE 3
				PRINT 魅力度
		ENDSELECT
		IF FLAG:AUTOMODE
			PRINTFORML 上升了！
			TWAIT FLAG:AUTOMODE * 400, 0
		ELSE
			PRINTFORMW 上升了！
		ENDIF
		PET:(RESULT + 10) ++
	ENDIF
ELSE
	REUSELASTLINE 不正入力です。正しい値を入力してください。
	GOTO INPUT_LOOP
ENDIF
RETURN

;-----------------------------------
;ランクアップ用関数
;-----------------------------------
@PET_RANKUP(ARG:0)
#DIM  TEMP_REDRAW

VARSET LOCAL
PET:21 -= ARG:0
PET:1 ++

CURRENTREDRAW
TEMP_REDRAW = RESULT
REDRAW 0

PRINTL
SETCOLOR 255, 255, 0
IF FLAG:AUTOMODE
	PRINTFORML 階　級　提　升　！　！
	TWAIT FLAG:AUTOMODE * 400, 0
ELSE
	PRINTFORMW 階　級　提　升　！　！
ENDIF
RESETCOLOR
PRINTL
FOR LOCAL, 0, 5
	REDRAW 0
	PRINTFORML 恭喜！　請選択奨勵
	PRINTFORML 現在、階級提升的奨勵還有{5 - LOCAL}点
	PRINTFORML ランク:{PET:1 - 1, 4} →{PET:1, 4}
	PRINTFORML [0] - 戦闘能力   現在:{PET:10, 4}
	PRINTFORML [1] - 速度       現在:{PET:11, 4}
	PRINTFORML [2] - 干勁   　  現在:{PET:12, 4}
	PRINTFORML [3] - 魅力度     現在:{PET:13, 4}
	LOCAL:1 = 0
	$INPUT_LOOP
	REDRAW TEMP_REDRAW
	INPUT
	IF RESULT >= 0 && RESULT <= 3
		IF PET:(RESULT + 10) == 9999
			REUSELASTLINE 已経封頂了
			GOTO INPUT_LOOP
		ELSE
			PRINTL
			SELECTCASE RESULT
				CASE 0
					PRINT 戦闘能力
				CASE 1
					PRINT 速度
				CASE 2
					PRINT 幹勁
				CASE 3
					PRINT 魅力度
			ENDSELECT
			IF FLAG:AUTOMODE
				PRINTFORML 上升了！
				TWAIT FLAG:AUTOMODE * 400, 0
			ELSE
				PRINTFORMW 上升了！
			ENDIF
			PET:(RESULT + 10) ++
		ENDIF
	CLEARLINE 10 + LOCAL:1
	ELSE
		REUSELASTLINE 不正入力です。正しい値を入力してください。
		LOCAL:1 ++
		GOTO INPUT_LOOP
	ENDIF
NEXT
REDRAW TEMP_REDRAW
PRINTFORML 恭喜！　然後還是恭喜！
RETURN

;-----------------------------------
;ペットの名前変更用関数
;-----------------------------------
@RENAME_PET
#DIM  TEMP_REDRAW

CURRENTREDRAW
TEMP_REDRAW = RESULT
REDRAW 0

DRAWLINE
PRINTFORML 現在寵物的名字是【%PETNAME%】
PRINTFORML 請輸入名字（要取消時請直接按下Enter）

REDRAW TEMP_REDRAW

$INPUT_LOOP
INPUTS
IF RESULTS == ""
	RETURN
ELSE
	PETNAME = %RESULTS%
	IF FLAG:AUTOMODE
		PRINTFORML 寵物的名字変為了【%RESULTS%】。
		TWAIT FLAG:AUTOMODE * 400, 0
	ELSE
		PRINTFORMW 寵物的名字変為了【%RESULTS%】。
	ENDIF
ENDIF

;-----------------------------------
;ペット消去用関数
;-----------------------------------
@BYEBYE_PET(ARG)
#DIM LCOUNT
#DIM  TEMP_REDRAW

	CURRENTREDRAW
	TEMP_REDRAW = RESULT
	REDRAW 0

;ARG	デバッグ経由なら1
	LOCAL:0 = ARG
	DRAWLINE
	PRINTFORML 和寵物分別
	PRINTFORML 再也不会回来了
	PRINTFORML 至今為止投入的営養和道具全部白費了
	PRINTFORML 真的要這麼做麼？
	PRINTFORML [1] - 做
	PRINTFORML [0] - 不做
	$INPUT_LOOP
	INPUT
	IF RESULT == 1
		IF TALENT:1:140 > 1 || (FLAG:10 > 0 && TALENT:(FLAG:10):140 > 1) || (FLAG:11 > 0 && TALENT:(FLAG:11):140 > 1)
			IF LOCAL:0 || FLAG:10 == 0
				IF PET_SUBMISSION_PT() / GET_MEMBER_SUM() > 60 && LOCAL:0 == 0
					CALLFORM PRINT_MESSAGE(1, 514, 4, CALLNAME:1, PETNAME, 1)
					GOTO INPUT_LOOP
				ENDIF
				CALLFORM PRINT_MESSAGE(1, 514, 4, CALLNAME:1, PETNAME, 0)

				VARSET PET
				VARSET PETNAME
				FOR LCOUNT, 0, CHARANUM
					CFLAG:LCOUNT:400 = 0
				NEXT
				TRYCALLFORM SET_ENEMY_DATA_99(0)
				RETURN
			ENDIF
			CALL LINK_FALL_2
			RETURN
		ELSE
			IF PET_SUBMISSION_PT() / GET_MEMBER_SUM() > 60 && LOCAL:0 == 0
				CALLFORM PRINT_MESSAGE(1, 514, 4, CALLNAME:1, PETNAME, 1)
				GOTO INPUT_LOOP
			ENDIF
			CALLFORM PRINT_MESSAGE(1, 514, 4, CALLNAME:1, PETNAME, 0)

			VARSET PET
			VARSET PETNAME
			FOR LCOUNT, 0, CHARANUM
				CFLAG:LCOUNT:400 = 0
			NEXT
			TRYCALLFORM SET_ENEMY_DATA_99(0)
			RETURN
		ENDIF
	ELSEIF RESULT == 0
		RETURN
	ENDIF
	
	REDRAW TEMP_REDRAW
	
