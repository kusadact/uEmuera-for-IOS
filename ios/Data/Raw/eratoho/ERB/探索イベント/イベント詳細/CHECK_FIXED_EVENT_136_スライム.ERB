;固定イベント
;RETURN	0:失敗した　1:成功した　2:以後のイベントスキップ
@CHECK_FIXED_EVENT_136
;LOCAL
;0	LOOP
;1	目標値
;2	達成値
;3	戻り値
;4	被害者あり
;5	身体に張り付く

LOCAL:3 = 0

;目標値（イベント難易度）決定
LOCAL:1 = 0


;達成値決定
CALL GET_SEARCH_RATE
LOCAL:2 = RESULT


IF LOCAL:2 >= LOCAL:1
	CALL ADD_ABL_EXP_PT(0, 300)
	PRINTFORML 在迷宮内探索的%CALLNAME:1%的臉被水滴滴中…
	IF FLAG:AUTOMODE
		PRINTFORML 突然抬頭一看、発現有大量的史莱姆正從天花板上襲撃了過来！
		TWAIT FLAG:AUTOMODE * 400, 0
	ELSE
		PRINTFORMW  突然抬頭一看、発現有大量的史莱姆正從天花板上襲撃了過来！
	ENDIF

	PRINTFORML 
	LOCAL:4 = 0
	FOR LOCAL:0, 1, CHARANUM
		;現在位置が被っているかチェック
		IF CFLAG:1:4 == CFLAG:(LOCAL:0):4 && CFLAG:(LOCAL:0):2 == 0 && CFLAG:(LOCAL:0):3 == 0 && CFLAG:(LOCAL:0):21 == 0
			CALL REACTION_TRAP(LOCAL:0)
			IF 90 > RAND:(100 + ABL:(LOCAL:0):5 * 50) && RESULT == 1
				CALL ADD_ABL_EXP(5, (LOCAL:0), 1000 + RAND:(ABL:(LOCAL:0):5 * 500 + 1))
				CALL PRINT_MESSAGE((LOCAL:0), 200, 136, CALLNAME:(LOCAL:0), "", 1)
				IF FLAG:529 == 1
					BASE:(LOCAL:0):5 += MAXBASE:(LOCAL:0):3 * 2
				ELSE
					CALL DAMAGE_COMMON((LOCAL:0), 3, 10000, 100)
				ENDIF
				LOCAL:4 = 1
				IF RAND:3 == 0
					CFLAG:(LOCAL:0):48 = 1
					LOCAL:5 = 1
					CALL PRINT_MESSAGE(LOCAL:0, 443, 0, CALLNAME:(LOCAL:0), "")
				ENDIF
			ELSE
				CALL ADD_ABL_EXP(5,(LOCAL:0) , 500 + RAND:(ABL:(LOCAL:0):5 * 200 + 1))
				CALL PRINT_MESSAGE((LOCAL:0), 200, 136, CALLNAME:(LOCAL:0), "", 2)
			ENDIF
		ENDIF
	NEXT
	
	IF LOCAL:5
		PRINTFORML 好幾隻史莱姆就像是衣服一樣貼在了身体之上…
		IF FLAG:AUTOMODE
			TWAIT FLAG:AUTOMODE * 500, 0
		ELSE
			PRINTFORMW 
		ENDIF
	ELSEIF LOCAL:4
		PRINTFORML 
		PRINTFORML 只是把衣服溶解之後就満足了、史莱姆就這麼直接離開了…
	ELSE
		PRINTFORML 
		PRINTFORML 回避了史莱姆的突撃、慌忙逃走了…
	ENDIF
	
	IF FLAG:AUTOMODE
		TWAIT FLAG:AUTOMODE * 500, 0
	ELSE
		WAIT
	ENDIF
	
	;別の場所に再配置
	FLAG:136 = RAND:30 + 1
	LOCAL:3 = 1
ELSE
	;見つからなかった場合（通常は何もしない）
ENDIF

RETURN LOCAL:3

