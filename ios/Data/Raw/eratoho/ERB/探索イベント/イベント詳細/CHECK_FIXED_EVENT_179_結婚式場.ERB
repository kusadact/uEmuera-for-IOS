;固定イベント
;RETURN	0:失敗した　1:成功した　2:以後のイベントスキップ
@CHECK_FIXED_EVENT_179
;LOCAL
;0	LOOP
;1	目標値
;2	達成値
;3	戻り値
;4	キャラ選択
;5	ダメージ乱数

LOCAL:3 = 0

;目標値（イベント難易度）決定
LOCAL:1 = 0


;達成値決定
CALL GET_SEARCH_RATE
LOCAL:2 = RESULT

;ペット所持かつ誰かが素質ペットでないと発見不可
IF LOCAL:2 >= LOCAL:1 && PET:0 && (TALENT:1:140 || TALENT:(FLAG:10):140 || TALENT:(FLAG:11):140)
	PRINTFORML 在迷宮的最深処発現了奇妙的空間
	PRINTFORML %PETNAME%想要把%CALLNAME:1%%TACHI()%帯過去……
	CALL PRINT_MESSAGE(1, 200, 179, CALLNAME:1, PETNAME, 0)
	CALL PRINT_MESSAGE(FLAG:10, 200, 179, CALLNAME:1, PETNAME, 0)
	CALL PRINT_MESSAGE(FLAG:11, 200, 179, CALLNAME:1, PETNAME, 0)
	$INPUT_LOOP
	PRINTL 怎麼辦？
	PRINTL
	PRINTFORML [ 1] 進去
	PRINTFORML [ 0] 離開這個地方
	
	IF FLAG:AUTOMODE
		TINPUT FLAG:AUTOMODE * 1000 , MIN(TALENT:1:140, 1), 0, ""
	ELSE
		INPUT
	ENDIF

	IF RESULT < 0 || RESULT >= 2
		GOTO INPUT_LOOP
	ELSEIF RESULT == 1
		DRAWLINE
		PRINTL 要讓誰一起去？
		DRAWLINE
		IF TALENT:1:140 == 1
			PRINTFORML [1] %CALLNAME:1%
		ENDIF
		IF FLAG:10 && TALENT:(FLAG:10):140 == 1
			PRINTFORML [2] %CALLNAME:(FLAG:10)%
		ENDIF
		IF FLAG:11 && TALENT:(FLAG:11):140 == 1
			PRINTFORML [3] %CALLNAME:(FLAG:11)%
		ENDIF
		PRINTFORML [0] 返回
		
		IF FLAG:AUTOMODE
			TINPUT FLAG:AUTOMODE * 1000 , 1, 0, ""
		ELSE
			INPUT
		ENDIF
	
		IF RESULT <= 0 || RESULT >= 4
			GOTO INPUT_LOOP
		ELSEIF RESULT == 1
			LOCAL:4 = 1
		ELSEIF RESULT == 2 && FLAG:10
			LOCAL:4 = FLAG:10
		ELSEIF RESULT == 3 && FLAG:11
			LOCAL:4 = FLAG:11
		ENDIF
		;結婚式前メッセージ
		CALL PRINT_MESSAGE(LOCAL:4, 200, 179, CALLNAME:1, PETNAME, 1)
		IF PET:0 >= 101 && PET:0 <= 105
			CALLFORM PRINT_MESSAGE(PET:9, 1200, 179, CALLNAME:1, PETNAME, 1)
		ENDIF
		
		;触手服婚紗授与
		PRINTFORML 從地上出現了内側満是触手的純白的婚紗穿在了%CALLNAME:(LOCAL:4)%的身体之上……
		CFLAG:(LOCAL:4):501 = 20
		CFLAG:(LOCAL:4):40 = 1
		CALL PRINT_MESSAGE(LOCAL:4, 200, 179, CALLNAME:1, PETNAME, 2)
		IF PET:0 >= 101 && PET:0 <= 105
			CALLFORM PRINT_MESSAGE(PET:9, 1200, 179, CALLNAME:1, PETNAME, 2)
		ENDIF
		;誓いの公開レイプ
		PRINTFORML %PETNAME%把%CALLNAME:(LOCAL:4)%拉到了身辺！
		CALL PRINT_MESSAGE(LOCAL:4, 200, 179, CALLNAME:1, PETNAME, 3)
		IF PET:0 >= 101 && PET:0 <= 105
			CALLFORM PRINT_MESSAGE(PET:9, 1200, 179, CALLNAME:1, PETNAME, 3)
		ENDIF
		FOR LOCAL:0, 0, 10
			LOCAL:5 = RAND:5
			TRYCALLFORM FIX_PT_ACTION_{54 + LOCAL:5}(LOCAL:4)
			CFLAG:(LOCAL:4):50 = 54 + LOCAL:5
			CALL PET_RAPE(LOCAL:4)
		NEXT
		;誓いの公開孕ませ
		PRINTFORML 為了満足%CALLNAME:(LOCAL:4)%懷孕願望的%PETNAME%開始不断地灌溉着白濁液……
		CALL PRINT_MESSAGE(LOCAL:4, 200, 179, CALLNAME:1, PETNAME, 4)
		IF PET:0 >= 101 && PET:0 <= 105
			CALLFORM PRINT_MESSAGE(PET:9, 1200, 179, CALLNAME:1, PETNAME, 4)
		ENDIF
		CALL PARASITE_TYPE(LOCAL:4, 1, PET:0, 8 + LIMIT(RAND:4 + RAND:4 + RAND:4 + RAND:4, 1, 10), 2)
		CALL ADD_ABL_EXP(14, LOCAL:4, 100)
		;素質新娘入手
		PRINTFORML %CALLNAME:(LOCAL:4)%成為了%PETNAME%的【新娘】……
		;新娘入手を履歴に残す
		IF TALENT:(LOCAL:4):140 != 2
			TALENT:(LOCAL:4):140 = 2
			CALL ADD_HISTORY(DAY, LOCAL:4, 0, 17, , @"%PETNAME%")
		ENDIF
		CALL PRINT_MESSAGE(LOCAL:4, 200, 179, CALLNAME:1, PETNAME, 5)
		IF PET:0 >= 101 && PET:0 <= 105
			CALLFORM PRINT_MESSAGE(PET:9, 1200, 179, CALLNAME:1, PETNAME, 5)
		ENDIF
		;刻印追加
		CALL GET_LOSE_MARK(LOCAL:4, PET:0)
		;PTメンバーは結婚報告すでにされている扱い
		IF LOCAL:4 == 1
			CFLAG:(FLAG:10):180 = 1
			CFLAG:(FLAG:11):180 = 1
		ENDIF
		
		;結婚式後メッセージ
		CALL PRINT_MESSAGE(LOCAL:4, 200, 179, CALLNAME:1, PETNAME, 6)
		IF PET:0 >= 101 && PET:0 <= 105
			CALLFORM PRINT_MESSAGE(PET:9, 1200, 179, CALLNAME:1, PETNAME, 6)
		ENDIF
		
		;重婚用に残す
	ELSE
		CALL PRINT_MESSAGE(1, 200, 179, CALLNAME:1, PETNAME, 8)
		CALL PRINT_MESSAGE(FLAG:10, 200, 179, CALLNAME:1, PETNAME, 8)
		CALL PRINT_MESSAGE(FLAG:11, 200, 179, CALLNAME:1, PETNAME, 8)
	ENDIF
	
	PRINTFORML %CALLNAME:1%%TACHI()%離開了這個地方…
		;同じ場所に残す
		LOCAL:3 = 0
ELSE
	;見つからなかった場合（通常は何もしない）
ENDIF

RETURN LOCAL:3

