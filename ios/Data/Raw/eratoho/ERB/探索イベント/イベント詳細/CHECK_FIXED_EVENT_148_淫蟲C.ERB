;固定イベント
;RETURN	0:失敗した　1:成功した　2:以後のイベントスキップ
@CHECK_FIXED_EVENT_148
#DIM ANYONE_RAPED
;LOCAL
;0	LOOP
;1	目標値
;2	達成値
;3	戻り値
;4	被害者あり
;5	ダメージ基準値

LOCAL:3 = 0

;目標値（イベント難易度）決定
LOCAL:1 = LIMIT(RAND:100, 50, 100) + RAND:150


;達成値決定
CALL GET_SEARCH_RATE
LOCAL:2 = RESULT


IF LOCAL:2 >= LOCAL:1
	CALL ADD_ABL_EXP_PT(0, LOCAL:1 * 10)
	PRINTFORML %CALLNAME:1%%TACHI()%找到了淫蟲的巣穴！
	IF FLAG:AUTOMODE
		PRINTFORML 大量的淫蟲襲向了%CALLNAME:1%%TACHI()%！
		TWAIT FLAG:AUTOMODE * 400, 0
	ELSE
		PRINTFORMW  大量的淫蟲襲向了%CALLNAME:1%%TACHI()%！
	ENDIF

	PRINTFORML 

	VARSET ANYONE_RAPED

	;コンフィグによってふたなり化がONOFFあるので主人公は別処理
	CALL REACTION_TRAP(1)
	IF BASE:1:0 < 0 || RESULT == 1
		TFLAG:63 = 2
		CALL PRINT_MESSAGE(1, 200, 148, CALLNAME:1, "", 1)
		LOCAL:5 = CALC_SENSITIVITY(1, TFLAG:63, LOCAL:1)
		CALL DAMAGE_COMMON(1, 2, LOCAL:5 * 7 * (TALENT:1:103 + 2) * (TALENT:1:77 + 1), 500)

		IF RAND:3 == 0 && GET_PENIS(1) == 0 && ( FLAG:520 == 1 || FLAG:520 == 2 )
			PRINTFORML 一部分淫蟲吸附在%CALLNAME:1%的陰蒂之上、開始了一体化的寄生……
			PRINTFORML %CALLNAME:1%成為了【扶她】！
			CALL PRINT_MESSAGE(1, 200, 148, CALLNAME:1, "", 3)
			CFLAG:1:42 = 1 + RAND:4 + RAND:3 + RAND:2
		ENDIF
		
		IF RAND:4 == 0 && TALENT:1:103 <= 2
	IF FLAG:AUTOMODE
		PRINTFORML %CALLNAME:1%的身体的樣子有些奇怪。看来、是因為淫蟲的体液的作用而改変了体質…
		PRINTFORML %CALLNAME:1%的\@ GET_PENIS(1) ? 陰茎 # 陰蒂 \@変敏感了一些
		TWAIT FLAG:AUTOMODE * 400, 0
	ELSE
		PRINTFORMW  %CALLNAME:1%的身体的樣子有些奇怪。看来、是因為淫蟲的体液的作用而改変了体質…
		PRINTFORMW  %CALLNAME:1%的\@ GET_PENIS(1) ? 陰茎 # 陰蒂 \@変敏感了一些
	ENDIF

			TALENT:1:103 += 1
		ENDIF
		ANYONE_RAPED++
	ELSE
		PRINTFORML %CALLNAME:1%強行打倒了附近的淫虫！
	ENDIF

	;ふたなり化フラグの都合で主人公以外を一括処理
	FOR LOCAL:0, 2, CHARANUM
		;現在位置が被っているかチェック
		IF CFLAG:1:4 == CFLAG:(LOCAL:0):4 && CFLAG:(LOCAL:0):2 == 0 && CFLAG:(LOCAL:0):3 == 0 && CFLAG:(LOCAL:0):21 == 0
			CALL REACTION_TRAP(LOCAL:0)
			IF BASE:(LOCAL:0):0 < 0 || RESULT == 1
				TFLAG:63 = 2
				CALL PRINT_MESSAGE((LOCAL:0), 200, 148, CALLNAME:(LOCAL:0), "")
				LOCAL:5 = CALC_SENSITIVITY((LOCAL:0), TFLAG:63, LOCAL:1)
				;◆発情追加のため、ダメージ軽減
				CALL DAMAGE_COMMON((LOCAL:0), 2, LOCAL:5 * 7 * (TALENT:(LOCAL:0):103 + 2) * (TALENT:(LOCAL:0):77 + 1), 500);◆
				IF RAND:3 == 0 && GET_PENIS(LOCAL:0) == 0 && ( FLAG:520 == 1 || FLAG:520 == 3 )
						PRINTFORML 一部分淫蟲吸附在%CALLNAME:(LOCAL:0)%的陰蒂之上、開始了一体化的寄生……
						PRINTFORML %CALLNAME:(LOCAL:0)%成為了【扶她】！
						CALL PRINT_MESSAGE((LOCAL:0), 200, 148, CALLNAME:1, "", 3)
						CFLAG:(LOCAL:0):42 = 1 + RAND:4 + RAND:3 + RAND:2
					ENDIF
				IF RAND:4 == 0 && TALENT:(LOCAL:0):103 <= 2
					IF FLAG:AUTOMODE
						PRINTFORML %CALLNAME:(LOCAL:0)%的身体的樣子有些奇怪。看来、是因為淫蟲的体液的作用而改変了体質…
						PRINTFORML %CALLNAME:(LOCAL:0)%的\@ GET_PENIS(LOCAL:0) ? 陰茎 # 陰蒂 \@変敏感了一些
						TWAIT FLAG:AUTOMODE * 400, 0
					ELSE
						PRINTFORMW  %CALLNAME:(LOCAL:0)%的身体的樣子有些奇怪。看来、是因為淫蟲的体液的作用而改変了体質…
						PRINTFORMW  %CALLNAME:(LOCAL:0)%的\@ GET_PENIS(LOCAL:0) ? 陰茎 # 陰蒂 \@変敏感了一些
					ENDIF

					TALENT:(LOCAL:0):103 += 1
				ENDIF
				ANYONE_RAPED++
			ELSE
				PRINTFORML %CALLNAME:(LOCAL:0)%強行打倒了附近的淫虫！
			ENDIF
		ENDIF
	NEXT
	IF ANYONE_RAPED
		IF FLAG:AUTOMODE
			PRINTFORML 狠狠地侵犯完%CALLNAME:1%%TACHI()%的淫蟲們、就這樣直接離開了…
			TWAIT FLAG:AUTOMODE * 400, 0
		ELSE
			PRINTFORMW  狠狠地侵犯完%CALLNAME:1%%TACHI()%的淫蟲們、就這樣直接離開了…
		ENDIF

	ELSE
		IF FLAG:AUTOMODE
			PRINTFORML 突然襲撃被躲開的淫蟲們、從肉色的地面上逃走了…
			TWAIT FLAG:AUTOMODE * 400, 0
		ELSE
			PRINTFORMW  突然襲撃被躲開的淫蟲們、從肉色的地面上逃走了…
		ENDIF

	ENDIF
	TFLAG:63 = 0
	
	
	IF FLAG:AUTOMODE
		TWAIT FLAG:AUTOMODE * 500, 0
	ELSE
		WAIT
	ENDIF
	
	;別の場所に再配置
	FLAG:148 = RAND:30 + 1
	LOCAL:3 = 1
ELSE
	;見つからなかった場合（通常は何もしない）
ENDIF

RETURN LOCAL:3

