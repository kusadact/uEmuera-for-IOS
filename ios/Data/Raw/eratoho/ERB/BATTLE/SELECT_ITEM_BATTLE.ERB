;戦闘中に使用するアイテムを選択する
;RETURN 0:使用キャンセル 1:使用した
@SELECT_ITEM_BATTLE(CHARA_ID)
#DIM CHARA_ID

	DRAWLINE
	PRINTFORML 請選択要使用的道具
	DRAWLINE

	IF CHECK_STOCK_ITEM(50) > 0
		PRINTFORML [ 1] %ITEMNAME:50, 20, LEFT%  {CHECK_STOCK_ITEM(50)}/{GET_ITEM_MAX(50)}個   回復一人50％的HP
	ELSE
		SETCOLOR 0x333333
		PRINTFORML [ 1] －－－
		RESETCOLOR
	ENDIF
	IF CHECK_STOCK_ITEM(51) > 0
		PRINTFORML [ 2] %ITEMNAME:51, 20, LEFT%  {CHECK_STOCK_ITEM(51)}/{GET_ITEM_MAX(51)}個   回復一人100％的HP
	ELSE
		SETCOLOR 0x333333
		PRINTFORML [ 2] －－－
		RESETCOLOR
	ENDIF
	IF CHECK_STOCK_ITEM(52) > 0
		PRINTFORML [ 3] %ITEMNAME:52, 20, LEFT%  {CHECK_STOCK_ITEM(52)}/{GET_ITEM_MAX(52)}個   回復一人25％的MP 使用者獲得【鼓舞】効果
	ELSE
		SETCOLOR 0x333333
		PRINTFORML [ 3] －－－
		RESETCOLOR
	ENDIF
	IF CHECK_STOCK_ITEM(53) > 0
		PRINTFORML [ 4] %ITEMNAME:53, 20, LEFT%  {CHECK_STOCK_ITEM(53)}/{GET_ITEM_MAX(53)}個   回復一人50％的MP 使用者獲得【鼓舞】効果
	ELSE
		SETCOLOR 0x333333
		PRINTFORML [ 4] －－－
		RESETCOLOR
	ENDIF
	IF CHECK_STOCK_ITEM(54) > 0
		PRINTFORML [ 5] %ITEMNAME:54, 20, LEFT%  {CHECK_STOCK_ITEM(54)}/{GET_ITEM_MAX(54)}個   回復一人100％的CP
	ELSE
		SETCOLOR 0x333333
		PRINTFORML [ 5] －－－
		RESETCOLOR
	ENDIF
	IF CHECK_STOCK_ITEM(55) > 0
		PRINTFORML [ 6] %ITEMNAME:55, 20, LEFT%  {CHECK_STOCK_ITEM(55)}/{GET_ITEM_MAX(55)}個   回復一人100％的EP、TP変為0
	ELSE
		SETCOLOR 0x333333
		PRINTFORML [ 6] －－－
		RESETCOLOR
	ENDIF
	IF CHECK_STOCK_ITEM(56) > 0
		PRINTFORML [ 7] %ITEMNAME:56, 20, LEFT%  {CHECK_STOCK_ITEM(56)}/{GET_ITEM_MAX(56)}個   一人進入発情状態、TP変為200
	ELSE
		SETCOLOR 0x333333
		PRINTFORML [ 7] －－－
		RESETCOLOR
	ENDIF
	IF CHECK_STOCK_ITEM(57) > 0
		PRINTFORML [ 8] %ITEMNAME:57, 20, LEFT%  {CHECK_STOCK_ITEM(57)}/{GET_ITEM_MAX(57)}個   治療拘束・発情・妊娠・戦意喪失以外的状態異常
	ELSE
		SETCOLOR 0x333333
		PRINTFORML [ 8] －－－
		RESETCOLOR
	ENDIF
	IF CHECK_STOCK_ITEM(58) > 0
		PRINTFORML [ 9] %ITEMNAME:58, 20, LEFT%  {CHECK_STOCK_ITEM(58)}/{GET_ITEM_MAX(58)}個   治療一人的戦意喪失状態、回復25％的MP 使用者獲得【治療】効果
	ELSE
		SETCOLOR 0x333333
		PRINTFORML [ 9] －－－
		RESETCOLOR
	ENDIF
	IF CHECK_STOCK_ITEM(59) > 0
		PRINTFORML [10] %ITEMNAME:59, 20, LEFT%  {CHECK_STOCK_ITEM(59)}/{GET_ITEM_MAX(59)}個   必定可以從戦闘逃走(被拘束的同伴除外)
	ELSE
		SETCOLOR 0x333333
		PRINTFORML [10] －－－
		RESETCOLOR
	ENDIF
	IF CHECK_STOCK_ITEM(71) > 0
		PRINTFORML [22] %ITEMNAME:71, 20, LEFT%  {CHECK_STOCK_ITEM(71)}/{GET_ITEM_MAX(71)}個   能浄化房間的便利商品
	ELSE
		SETCOLOR 0x333333
		PRINTFORML [22] －－－
		RESETCOLOR
	ENDIF
	PRINTFORML [ 0] 取消

	$INPUT_LOOP
	INPUT

	IF RESULT == 0
		RETURN 0
	ELSEIF GROUPMATCH(RESULT, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 22) && CHECK_STOCK_ITEM(RESULT + 49) > 0
		
		;アイテムの使用対象を選択(対象を取らないアイテムは除外)
		CFLAG:CHARA_ID:54 = RESULT + 49
		IF !GROUPMATCH(CFLAG:CHARA_ID:54, 59, 71)
			PRINTFORML 要讓誰使用？
			CALL SELECT_PT_TARGET(0)
			;キャンセルされたら最初から
			IF RESULT == 0
				CFLAG:CHARA_ID:54 = 0
				RESTART
			ENDIF
			CFLAG:CHARA_ID:51 = RESULT
		ELSE
			CFLAG:CHARA_ID:51 = CHARA_ID
		ENDIF
		RETURN 1
	ELSE
		REUSELASTLINE 輸入値不正確。請重新輸入
		GOTO INPUT_LOOP
	ENDIF

	RESTART


;指定アイテムの戦闘中ストック数を返す
;コマンド選択～実行まで間は、実際のストック数と利用出来るストック数に差が生じる
;この関数でストック数を超えてアイテム選択を出来ないよう対処する
@CHECK_STOCK_ITEM(ITEMID)
#FUNCTION
#DIM ITEMID
#DIM ITEM_COUNT

	ITEM_COUNT = ITEM:ITEMID
	
	SIF CFLAG:1:50 == 2 && CFLAG:1:54 == ITEMID
		ITEM_COUNT --
	SIF FLAG:10 && CFLAG:(FLAG:10):50 == 2 && CFLAG:(FLAG:10):54 == ITEMID
		ITEM_COUNT --
	SIF FLAG:11 && CFLAG:(FLAG:11):50 == 2 && CFLAG:(FLAG:11):54 == ITEMID
		ITEM_COUNT --
	
RETURNF LIMIT(ITEM_COUNT, 0, GET_ITEM_MAX(ITEMID))