;=================================================
;ニューゲーム時の処理
;=================================================
@EVENTFIRST
#DIM LCOUNT
#DIM QUICK
;LCOUNT	ループ用
;LOCAL:5	処女モードの際の行数

	;開始時の時刻取得
	TIME:2 = GETMILLISECOND() / 1000

	;最初は１日目
	DAY = 1

	;最初は1周目
	FLAG:3 = 1

	;管理するキャラの人数設定
	CALL GET_CSVCHARA

	;＝＝＝ グローバルセーブから設定を読み込む ＝＝＝
	LOADGLOBAL
	IF RESULT
		FOR LCOUNT, 0, 101
			SIF LCOUNT == 84 && GLOBAL:(LCOUNT)
				GLOBAL:(LCOUNT) = 0
			FLAG:(LCOUNT + 500) = GLOBAL:(LCOUNT)
		NEXT
		;敵と出会ったかどうか記録　図鑑用
		CALL LOAD_GLOBAL_ENEMY_WIKI_DATA(0)
	ELSE
		ENEMY_WIKI_REGISTERED:0 = 1 ;移行しない
	ENDIF
	IF FLAG:509
		LOCAL = ANIME_CONFIG("FORCE", 2)
	ELSE
		LOCAL = ANIME_CONFIG("FORCE", 0)
	ENDIF
	
	;動作環境判別用フラグ
	;0:触手宮  1:りばーす
	FLAG:600 = 0

	$INPUT_LOOP_DIF
	;---難易度設定---
	
	PRINTFORML 請選択遊戲的難易度
	PRINTFORML （可以在「設定」変更為Easy～Lunatic）
	PRINTFORML [ 0] %"Very easy",12,LEFT%		%"適合想在觸手宮閒庭信步的人",10,LEFT%
	PRINTFORML [ 1] %"Easy",12,LEFT%			%"適合想要欺負触手的人",10,LEFT%
	PRINTFORML [ 2] %"Normal",12,LEFT%			%"適合想要有来有回的人",10,LEFT%
	PRINTFORML [ 3] %"Hard",12,LEFT%			%"適合喜歡艱難遊戲的人",10,LEFT%
	PRINTFORML [ 4] %"Lunatic",12,LEFT%			%"適合想一直全滅的人",10,LEFT%
	IF FLAG:学園 == 0
		PRINTFORML [ 5] %"Extra",12,LEFT%			%"在以Normal為基準難度的情況下試著從被捕獲的狀態逃走吧",10,LEFT%
		PRINTFORML [ 6] %"Phantasm",12,LEFT%		%"在以Lunatic為基準難度的情況下試著從被捕獲的狀態逃走吧",10,LEFT%
	ENDIF
	SIF GET_ENEMY_WIKI_REGISTERED(18)
		PRINTFORML [ 7] %"Doppel",12,LEFT%			%"只有幻影怪敵人的模式",10,LEFT%
	PRINTFORML [10] %"Trap",12,LEFT%			%"幾乎沒有敵人但是存在着大量陷穽的模式",10,LEFT%
	PRINTFORML 
	PRINTFORML [81] %"Minigame",12,LEFT%		%"小游戏",10,LEFT%
	IF FLAG:学園 == 0
		PRINTFORML [99] %"School",12,LEFT%		%"触手袭击的不是迷宫而是学园",10,LEFT%
	ELSE
		PRINTFORML [99] %"Dungeon",12,LEFT%		%"进入充满魔物和陷阱的迷宫",10,LEFT%
	ENDIF

	INPUT
	IF RESULT >= 0 && RESULT <= 4
		FLAG:4 = RESULT - 1
	ELSEIF RESULT == 5
		FLAG:4 = 1
		FLAG:999 = 1
	ELSEIF RESULT == 6
		FLAG:4 = 3
		FLAG:999 = 2
	ELSEIF RESULT == 7
		FLAG:4 = 3
		FLAG:998 = 18
	ELSEIF RESULT == 10
		FLAG:4 = 3
		FLAG:997 = 1
	ELSEIF RESULT == 81
		FLAG:997 = 81
		JUMP MINIGAME
	ELSEIF RESULT == 99
		IF FLAG:学園 == 0
			FLAG:学園 = 1
			GOTO INPUT_LOOP_DIF
		ELSE
			FLAG:学園 = 0
			GOTO INPUT_LOOP_DIF
		ENDIF

	ELSE
		CLEARLINE 1
		REUSELASTLINE 輸入値不正確。請重新輸入
		GOTO INPUT_LOOP_DIF
	ENDIF
	
	;＝＝＝ クイックスタート ＝＝＝
	;大半の設定確認をとばしOP行き
	FOR LCOUNT, 0, 100
		IF FLAG:(LCOUNT + 500)
			QUICK ++
		ENDIF
	NEXT
	IF QUICK > 1
	
		PRINTFORML 
		PRINTFORML 要使用快速啟動麼？
		PRINTFORML 除此以外的設定使用之前保存過的設定
		PRINTFORML ※推薦現在設定的配置文件画面中先進行保存。
		PRINTFORML 
		PRINTFORML 
		PRINTFORML [0] 是
		PRINTFORML [1] 否

		INPUT
		IF RESULT == 1
			
		ELSE
			CALL QUICK_START
			GOTO START_OP
		ENDIF
	ENDIF
	QUICK = 0
	;＝＝＝ チュートリアル設定 ＝＝＝
	;チュートリアル確認だけはグローバルセーブの管轄外とする
	PRINTL
	PRINTL ～給第一次玩的人へ～
	PRINTL 這個遊戲存在着各種各樣的要素。
	PRINTL 第一次玩的人、推薦在遊戲中通過教程確認各種操作。
	PRINTL  
	PRINTL  

	PRINTFORML 如上所述要把教程設定為ON麼？
	PRINTFORML [0] 是
	PRINTFORML [1] 否

	INPUT
	IF RESULT == 1
		PRINTFORMW 不会在遊戲中出現教程了
		FOR LCOUNT, 400, 500
			FLAG:(LCOUNT) |= 2
		NEXT
	ELSE
		FLAG:500 = 1
		PRINTFORMW 遊戲過程中会出現教程了
		CALL SHOW_TUTORIAL(0)
	ENDIF


	;--- 初期処理開始 ------------------
	;キャラ登録番号メモ
	;0		「あなた」が入っているが、使わない
	;1		主人公　このキャラを操作する
	;2～10	その他の仲間
	;敵データは配列DAにて管理する

	TARGET = -1
	ASSI = -1

	CALL START_CHARA_SELECT
	CALL SHOW_TUTORIAL(1)
	CALL OTHER_CHARA_SELECT



	;主人公の能力ボーナス選択
	;★EXモードではボーナスがない
	IF FLAG:999
		
	ELSE
		PRINTFORML 作為主人公的初期奨勵、可以讓喜歡的能力等級+1、或者獲得道具
		PRINTFORML ※原先就等級１的能力無法升級到等級２
		PRINTFORML  
		$INPUT_BONUS
		PRINTFORML 請選択初期奨勵
		FOR LCOUNT, 0, 16
			IF ABL:1:(LCOUNT)
				SETCOLOR 0x333333
				PRINTFORML [{LCOUNT, 2}] %ABLNAME:(LCOUNT)% 無法提升到更高了
				RESETCOLOR
			ELSE
				IF LCOUNT == 12
					IF FLAG:520
						PRINTFORML [{LCOUNT, 2}] %ABLNAME:(LCOUNT)% 提升（付与扶他素質)
						CONTINUE
					ELSE
						CONTINUE
					ENDIF
				ENDIF
				PRINTFORML [{LCOUNT, 2}] %ABLNAME:(LCOUNT)% 提升
			ENDIF
		NEXT
		PRINTFORML [16] 得到道具（得到一些回復道具等）
		PRINTFORML [17] 得到寵物（好好地照顧它吧）
		PRINTFORML [18] 獲得素質
		INPUT
		IF (RESULT >= 0) && (RESULT <= 15) && RESULT != 12 && (ABL:1:(RESULT) == 0)
			PRINTFORMW %ABLNAME:(RESULT)% 的等級上升了！
			ABL:1:RESULT += 1
		ELSEIF RESULT == 12
			ABL:1:12 += 1
			CFLAG:1:42 = 10
		ELSEIF RESULT == 16
			PRINTFORMW 獲得了緑茶×１、日本酒×１、備用衣物×１、煙玉×１！
			CALL ADD_ITEM(50, 1, 0)
			CALL ADD_ITEM(52, 1, 0)
			CALL ADD_ITEM(54, 1, 0)
			CALL ADD_ITEM(59, 1, 0)
		ELSEIF RESULT == 17
			CALL DEBUG_COMMAND_ペット追加
		ELSEIF RESULT == 18
			CALL FIRST_TALENT
			;キャンセルしたら戻る
			IF RESULT == 0
				GOTO INPUT_BONUS
			ENDIF
		ELSE
			REUSELASTLINE 輸入値不正確。請重新輸入
			GOTO INPUT_BONUS
		ENDIF

		;どのボーナスを選択していても、最初から緑茶と着替えだけは持っている
		CALL ADD_ITEM(50, 1, 0)
		CALL ADD_ITEM(54, 1, 0)
	ENDIF

	;難易度EASYなら更に初期アイテム追加
	IF FLAG:4 <= 0
		CALL ADD_ITEM(3, 1, 0)
		CALL ADD_ITEM(12, 1, 0)
		CALL ADD_ITEM(21, 1, 0)
		CALL ADD_ITEM(51, 1, 0)
		CALL ADD_ITEM(53, 1, 0)
		CALL ADD_ITEM(54, 1, 0)
		CALL ADD_ITEM(57, 1, 0)
		CALL ADD_ITEM(58, 1, 0)
		CALL ADD_ITEM(59, 3, 0)
		CALL ADD_ITEM(61, 1, 0)
		CALL ADD_ITEM(62, 1, 0)
		CALL ADD_ITEM(63, 1, 0)
	ENDIF
	
	;EXモードなら更に初期アイテム追加
	IF FLAG:999
		CALL ADD_ITEM(59, 2, 0)
	ENDIF

	PRINTFORML 只有主人公的性格可以自由的設定
	CALL SHOW_TUTORIAL(3)
	CALL CHANGE_PERSONALITY(1)
	
	;各種初期化処理　敵の初期化は順番の関係で移動
	CALL CHARA_INITIALIZE
	CALL MAP_INITIALIZE

	IF NO:1 == 0
		PRINTFORML 只有主人公、可以変更素質。
		PRINTFORML 要変更%CALLNAME:1%的素質麼？
		
		PRINTFORML [0] 默认
		PRINTFORML [1] 変更
		INPUT
		IF RESULT == 1
			CALL TALENT_SET(1)
		ENDIF
	ENDIF
	
	;＝＝＝ 口上 ＝＝＝
	
	PRINTL 
	PRINTL 遊戲開始後変更口上、可能会因為口上独自的特殊処理導致無法正常啟用
	PRINTL 要現在確認各個角色的口上設定麼？
		PRINTFORML [0] 默認　(存在口上的角色使用口上)
		PRINTFORML [1] 変更
		PRINTFORML [2] 口上全OFF
		INPUT
	IF RESULT == 1
		CALL KOJO_SELECT
		PRINTL 
		DRAWLINE
		PRINTL 
	ELSEIF RESULT == 2
		FOR LCOUNT, 1, CHARANUM
			CFLAG:(LCOUNT):701 = -1
		NEXT
		PRINTFORML 口上全部設定為了OFF
		FLAG:565 = 2
	ELSE
		PRINTFORML 設定完成
		FLAG:565 = 0
	ENDIF
	PRINTFORML 
	

	;追加難易度だとここは出ない
	IF FLAG:999 == 0
		CALL CONFIGURE_FIRST_SEX
	ELSEIF FLAG:学園
		;普通の服・体操着・スクール水着・セーラー服・半ズボンを初期ON
		CALL CALL SET_CLOTH_CONFIG( 1, "服装", 1)
		CALL CALL SET_CLOTH_CONFIG( 1, "服装", 2)
		CALL CALL SET_CLOTH_CONFIG( 1, "服装", 6)
		CALL CALL SET_CLOTH_CONFIG( 1, "服装", 9)
		CALL CALL SET_CLOTH_CONFIG( 1, "服装", 10)
	ENDIF

PRINTFORML 要確認初期設定麼？（開始後可以在設定里調整）
	PRINTFORML [0] 進行個別設定　：開始個別設定
	PRINTFORML [1] 基本設置　　　：限定只存在基本的系統・魔物
	PRINTFORML [2] 戦闘設置　　　：重視在戦闘中直接被玩弄的設定
	PRINTFORML [3] 堕落設置　　　：重視受到玩弄讓身心発生変化的設定
	PRINTFORML [4] 就這樣　　　　：採用默認、或者是以前的設定
	$INPUT_LOOP_STARTSET
	INPUT
IF RESULT == 0
	;ふたなりと豊乳化と尿意も最初に選べるように
	CALL CONFIGURE_FIRST_TALENT
	CALL CONFIGURE_FIRST_1
	CALL CLOTH_CONFIG_CLOTH_LIST
	CALL FOOT_EQUIP_CONFIG_FOOT_EQUIP_LIST
	CALL SET_CONFIGURE_4_8(1)
ELSEIF RESULT == 1
	FLAG:501 = 1
	FLAG:504 = 0
	FLAG:505 = 0
	FLAG:512 = 0
	FLAG:513 = 1
	FLAG:520 = 0
	FLAG:521 = 0
	FLAG:522 = 2
	FLAG:528 = 0
	FLAG:529 = 0
	FLAG:531 = 0
	FLAG:533 = 0
	FLAG:535 = 0
	FLAG:538 = 0

	FLAG:523 = 1
	FLAG:534 = 1

			FOR LCOUNT, 5, 20
				CALL SET_ENEMY_FILTER(LCOUNT, 0)
			NEXT

			FOR LCOUNT, 21, GET_ENEMY_NO_MAX() + 1
				IF ENEMY_NAME(LCOUNT) != "バグ触手"
					CALL SET_ENEMY_FILTER(LCOUNT, 1)
				ENDIF
			NEXT

ELSEIF RESULT == 2
	FLAG:501 = 0
	FLAG:504 = 0
	FLAG:505 = 0
	FLAG:512 = 1
	FLAG:513 = 0
	FLAG:520 = 0
	FLAG:521 = 1
	FLAG:522 = 0
	FLAG:529 = 1
	FLAG:531 = 0
	FLAG:533 = 1
	FLAG:535 = 0
	FLAG:538 = 1

	FLAG:523 = 1
	FLAG:534 = 1

			FOR LCOUNT, 5, 99
				CALL SET_ENEMY_FILTER(LCOUNT, 0)
			NEXT


ELSEIF RESULT == 3
	FLAG:501 = 0
	FLAG:504 = 1
	FLAG:505 = 1
	FLAG:512 = 0
	FLAG:513 = 1
	FLAG:520 = 1
	FLAG:521 = 0
	FLAG:522 = 1
	FLAG:529 = 0
	FLAG:531 = 2
	FLAG:533 = 1
	FLAG:535 = 1
	FLAG:538 = 3

	FLAG:523 = 1
	FLAG:534 = 1

			FOR LCOUNT, 5, 20
				CALL SET_ENEMY_FILTER(LCOUNT, 0)
			NEXT

			FOR LCOUNT, 21, 96
				IF LCOUNT != 49 && LCOUNT != 58 && LCOUNT != 86
					IF LCOUNT == 37 || LCOUNT == 40 || LCOUNT == 41 || LCOUNT == 44 || LCOUNT == 45 || LCOUNT == 47 || LCOUNT == 52 || LCOUNT == 70 || LCOUNT == 83 || LCOUNT == 89 || LCOUNT == 90 || LCOUNT == 92
						CALL SET_ENEMY_FILTER(LCOUNT, 0)
					ELSE
						CALL SET_ENEMY_FILTER(LCOUNT, 1)
					ENDIF
				ENDIF
			NEXT

ELSEIF RESULT == 4
;空

ELSE
	GOTO INPUT_LOOP_STARTSET
ENDIF
	$START_OP
	;初期配置敵の外見をコンフィグと合わせるためここで敵のイニシャライズ
	CALL ENEMY_INITIALIZE

	;コンフィグに合わせてキャラ再設定
	CALL CHARA_INITIALIZE_2

	PRINTL
	;ストーリー
	PRINTL オープニングを見ますか？
	CALL ASK_YN
	IF RESULT == 0
		IF FLAG:999
			CALL PRINT_MESSAGE(1, 299, 0, CALLNAME:1, "")
		ELSE
			CALL PRINT_MESSAGE(1, 203, 0, CALLNAME:1, "")
		ENDIF
	ENDIF
	
	CALL CHARA_BONDS
	
	;ゲーム開始時
	FOR LCOUNT, 1, CHARANUM
		CALL PRINT_MESSAGE(LCOUNT, 159, 0, CALLNAME:(LCOUNT), "")
	NEXT
	
	CALL EVENTFIRST_CHARABONUS

	BEGIN SHOP
;=================================================
